!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("proxy-compare")):"function"==typeof define&&define.amd?define(["exports","proxy-compare"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).valtio={},e.proxyCompare)}(this,(function(e,t){"use strict";var r=function(e){return"object"==typeof e&&null!==e},n=new WeakMap,o=new WeakSet,i=function(e,i,a,f,u,s,l,v,d){return void 0===e&&(e=Object.is),void 0===i&&(i=function(e,t){return new Proxy(e,t)}),void 0===a&&(a=function(e){return r(e)&&!o.has(e)&&(Array.isArray(e)||!(Symbol.iterator in e))&&!(e instanceof WeakMap)&&!(e instanceof WeakSet)&&!(e instanceof Error)&&!(e instanceof Number)&&!(e instanceof Date)&&!(e instanceof String)&&!(e instanceof RegExp)&&!(e instanceof ArrayBuffer)}),void 0===f&&(f=function(e){switch(e.status){case"fulfilled":return e.value;case"rejected":throw e.reason;default:throw e}}),void 0===u&&(u=new WeakMap),void 0===s&&(s=function(e,r,i){void 0===i&&(i=f);var a=u.get(e);if((null==a?void 0:a[0])===r)return a[1];var s=Array.isArray(e)?[]:Object.create(Object.getPrototypeOf(e));return t.markToTrack(s,!0),u.set(e,[r,s]),Reflect.ownKeys(e).forEach((function(r){if(!Object.getOwnPropertyDescriptor(s,r)){var a=Reflect.get(e,r),f={value:a,enumerable:!0};o.has(a)?t.markToTrack(a,!1):a instanceof Promise?(delete f.value,f.get=function(){return i(a)}):n.has(a)&&(f.value=c(a,i)),Object.defineProperty(s,r,f)}})),s}),void 0===l&&(l=new WeakMap),void 0===v&&(v=[1,1]),void 0===d&&(d=function c(f){if(!r(f))throw new Error("object required");var u=l.get(f);if(u)return u;var d=v[0],p=new Set,y=function(e,t){void 0===t&&(t=++v[0]),d!==t&&(d=t,p.forEach((function(r){return r(e,t)})))},h=v[1],g=function(e){return function(t,r){var n=[].concat(t);n[1]=[e].concat(n[1]),y(n,r)}},b=new Map,w=function(e){var t,r=b.get(e);r&&(b.delete(e),null==(t=r[1])||t.call(r))},j=Array.isArray(f)?[]:Object.create(Object.getPrototypeOf(f)),m=i(j,{deleteProperty:function(e,t){var r=Reflect.get(e,t);w(t);var n=Reflect.deleteProperty(e,t);return n&&y(["delete",[t],r]),n},set:function(i,f,u,s){var v=Reflect.has(i,f),d=Reflect.get(i,f,s);if(v&&(e(d,u)||l.has(u)&&e(d,l.get(u))))return!0;w(f),r(u)&&(u=t.getUntracked(u)||u);var h=u;if(u instanceof Promise)u.then((function(e){u.status="fulfilled",u.value=e,y(["resolve",[f],e])})).catch((function(e){u.status="rejected",u.reason=e,y(["reject",[f],e])}));else{!n.has(u)&&a(u)&&(h=c(u));var j=!o.has(h)&&n.get(h);j&&function(e,t){if(p.size){var r=t[3](g(e));b.set(e,[t,r])}else b.set(e,[t])}(f,j)}return Reflect.set(i,f,h,s),y(["set",[f],u,d]),!0}});l.set(f,m);var O=[j,function(e){return void 0===e&&(e=++v[1]),h===e||p.size||(h=e,b.forEach((function(t){var r=t[0][1](e);r>d&&(d=r)}))),d},s,function(e){p.add(e),1===p.size&&b.forEach((function(e,t){var r=e[0];e[1];var n=r[3](g(t));b.set(t,[r,n])}));return function(){p.delete(e),0===p.size&&b.forEach((function(e,t){var r=e[0],n=e[1];n&&(n(),b.set(t,[r]))}))}}];return n.set(m,O),Reflect.ownKeys(f).forEach((function(e){var t=Object.getOwnPropertyDescriptor(f,e),r="value"in t;delete t.value,Object.defineProperty(j,e,t),r&&(m[e]=f[e])})),m}),[d,n,o,e,i,a,f,u,s,l,v]},a=i()[0];function c(e,t){var r=n.get(e),o=r[0],i=r[1];return(0,r[2])(o,i(),t)}var f=i;e.getVersion=function(e){var t=n.get(e);return null==t?void 0:t[1]()},e.proxy=function(e){return void 0===e&&(e={}),a(e)},e.ref=function(e){return o.add(e),e},e.snapshot=c,e.subscribe=function(e,t,r){var o,i=n.get(e),a=[],c=i[3],f=!1,u=c((function(e){a.push(e),r?t(a.splice(0)):o||(o=Promise.resolve().then((function(){o=void 0,f&&t(a.splice(0))})))}));return f=!0,function(){f=!1,u()}},e.unstable_buildProxyFunction=f}));
